import{b as ye,r as f,c as xe,j as i,S as x,L as Q,t as ee}from"./index-DKzGAutY.js";import{feedService as me}from"./feed-Brgwye14.js";const u=480,h=640,k=5,p=u/k,m=50,E=8,b=40,a=100,te=30,C=3,Se=()=>{const{updateStat:X,incrementStat:I,shopState:H,addCoins:B,userProfile:se,stats:M}=ye()||{updateStat:()=>{},incrementStat:()=>{},shopState:null},G=f.useRef(null),[O,R]=f.useState(0),[ne,W]=f.useState(C),[z,Y]=f.useState(parseInt(localStorage.getItem("galaxyHighScore"))||0);f.useEffect(()=>{M?.galaxyHighScore>z&&Y(M.galaxyHighScore)},[M]);const[q,N]=f.useState(!1),[F,le]=f.useState(!1),[oe,V]=f.useState(!1),d=f.useRef(!1),S=f.useRef(null),{playBeep:ie,playCrash:Z,playCollect:A,playWin:re}=xe(),c=f.useRef({lane:2,bullets:[],enemies:[],boss:null,enemyLasers:[],lastEnemySpawn:0,lastShotTime:0,scoreInternal:0,invincible:0,shake:0,animationId:null});f.useEffect(()=>{const l=new Image;return l.src="/assets/boy_face.png",S.current=l,()=>cancelAnimationFrame(c.current.animationId)},[]);const j=()=>{R(0),W(C),N(!1),le(!1),V(!0),d.current=!0,c.current={lane:2,bullets:[],enemies:[],boss:null,enemyLasers:[],lastEnemySpawn:0,lastShotTime:0,scoreInternal:0,invincible:0,shake:0,stars:[],powerups:[],weaponLevel:1,weaponTimer:0,level:1,bossActive:!1,animationId:null};for(let l=0;l<50;l++)c.current.stars.push({x:Math.random()*u,y:Math.random()*h,size:Math.random()*2,speed:.5+Math.random()*2});requestAnimationFrame(K)},U=()=>{const l=c.current;l.invincible>0||(l.invincible=60,l.shake=10,Z(),W(e=>{const t=e-1;return t<=0&&ae(),t}))},ae=l=>{V(!1),d.current=!1,N(!0),Z();const e=c.current.scoreInternal+0;if(R(e),e>z){Y(e),X&&X("galaxyHighScore",e);const t=se?.name||"Pilot";me.publish(`saved the Galaxy with score: ${e} ðŸš€`,"win",t)}I&&I("gamesPlayed","galaxy"),B&&B(Math.floor(e/10))},ce=l=>{const e=Math.floor(Math.random()*k),t=e*p+p/2-b/2,g=2+c.current.level+Math.random()*2;c.current.enemies.push({x:t,y:-b,lane:e,speed:g}),c.current.lastEnemySpawn=l},K=l=>{const e=G.current.getContext("2d"),t=c.current;let g=0,$=0;t.shake>0&&(g=(Math.random()-.5)*t.shake,$=(Math.random()-.5)*t.shake,t.shake*=.9,t.shake<.5&&(t.shake=0)),e.save(),e.translate(g,$),e.fillStyle="#000",e.fillRect(-20,-20,u+40,h+40),e.fillStyle="#fff",t.stars.forEach(n=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fill(),n.y+=n.speed,n.y>h&&(n.y=0,n.x=Math.random()*u)}),e.strokeStyle="#111",e.lineWidth=2;for(let n=1;n<k;n++)e.beginPath(),e.moveTo(n*p,0),e.lineTo(n*p,h),e.stroke();if(d.current){if(t.invincible>0&&t.invincible--,!t.boss){const s=t.level*1e3;if(t.scoreInternal>=s)t.boss={x:u/2-a/2,y:-a,hp:te*t.level,dir:1,flash:0,lastAttack:0,type:t.level%3},t.bossActive=!0,t.enemies=[];else{const o=Math.max(400,1e3-t.level*100);l-t.lastEnemySpawn>o&&ce(l)}}if(t.boss)if(t.boss.y<50)t.boss.y+=1;else{t.boss.x+=(2+t.level)*t.boss.dir,(t.boss.x+a>u||t.boss.x<0)&&(t.boss.dir*=-1);const s=Math.max(500,2e3-t.level*200);if(l-t.boss.lastAttack>s){const o=t.boss.x+a/2;t.level>=2&&(t.enemyLasers.push({x:o-10,y:t.boss.y+a,width:20,height:20,speed:6,dx:-2}),t.enemyLasers.push({x:o-10,y:t.boss.y+a,width:20,height:20,speed:6,dx:2})),t.enemyLasers.push({x:o-10,y:t.boss.y+a-20,width:20,height:40,speed:8,dx:0}),t.boss.lastAttack=l}}else Math.random()<.002&&t.powerups.length===0&&t.powerups.push({x:Math.random()*(u-40),y:-40,type:"DOUBLE",speed:2});t.bullets=t.bullets.filter(s=>s.y>-20),t.bullets.forEach(s=>s.y-=15),t.enemies.forEach(s=>s.y+=s.speed),t.enemyLasers=t.enemyLasers.filter(s=>s.y<h),t.enemyLasers.forEach(s=>{s.y+=s.speed,s.dx&&(s.x+=s.dx)}),t.powerups.forEach(s=>s.y+=s.speed);for(let s=t.bullets.length-1;s>=0;s--){const o=t.bullets[s];let w=!1;if(t.boss&&o.x>t.boss.x&&o.x<t.boss.x+a&&o.y>t.boss.y&&o.y<t.boss.y+a&&(t.boss.hp--,t.boss.flash=3,w=!0,A(),t.boss.hp<=0&&(I("bossKills",1),t.boss=null,t.level++,t.scoreInternal+=500,re(),ee())),!w&&!t.boss)for(let v=t.enemies.length-1;v>=0;v--){const T=t.enemies[v];if(o.x<T.x+b&&o.x+E>T.x&&o.y<T.y+b&&o.y+E>T.y){t.enemies.splice(v,1),t.scoreInternal+=50,R(t.scoreInternal),A(),w=!0;break}}w&&t.bullets.splice(s,1)}const n=t.lane*p+p/2-m/2,_=h-80,r={x:n,y:_,w:m,h:m};for(let s=t.enemies.length-1;s>=0;s--){const o=t.enemies[s];o.x<r.x+r.w&&o.x+b>r.x&&o.y<r.y+r.h&&o.y+b>r.y&&(U(),t.enemies.splice(s,1)),o.y>h&&t.enemies.splice(s,1)}for(let s=t.enemyLasers.length-1;s>=0;s--){const o=t.enemyLasers[s];o.x<r.x+r.w&&o.x+o.width>r.x&&o.y<r.y+r.h&&o.y+o.height>r.y&&(U(),t.enemyLasers.splice(s,1))}for(let s=t.powerups.length-1;s>=0;s--){const o=t.powerups[s];o.x<r.x+r.w&&o.x+30>r.x&&o.y<r.y+r.h&&o.y+30>r.y?(t.weaponLevel=2,t.weaponTimer=600,t.powerups.splice(s,1),A(),ee()):o.y>h&&t.powerups.splice(s,1)}}const pe=t.lane*p+p/2-m/2,ue=h-80;if(t.invincible%10<5){e.save(),e.translate(pe+m/2,ue+m/2),e.fillStyle=`rgba(0, 200, 255, ${.5+Math.random()*.5})`,e.beginPath(),e.moveTo(-15,20),e.lineTo(0,40+Math.random()*10),e.lineTo(15,20),e.fill();const n=H?.equipped?.galaxy||"ship_default";n==="ship_ufo"?(e.fillStyle="#00ff88",e.beginPath(),e.ellipse(0,0,25,10,0,0,Math.PI*2),e.fill(),e.fillStyle="rgba(200, 255, 255, 0.8)",e.beginPath(),e.arc(0,-5,12,Math.PI,0),e.fill(),e.fillStyle="yellow",e.beginPath(),e.arc(-15,0,3,0,Math.PI*2),e.arc(15,0,3,0,Math.PI*2),e.fill()):n==="ship_dragon"?(e.fillStyle="#00aa00",e.beginPath(),e.moveTo(0,-30),e.lineTo(10,-10),e.lineTo(-10,-10),e.fill(),e.fillStyle="#008800",e.beginPath(),e.moveTo(0,0),e.lineTo(30,20),e.lineTo(10,20),e.lineTo(0,40),e.lineTo(-10,20),e.lineTo(-30,20),e.fill(),e.fillStyle="red",e.beginPath(),e.arc(-5,-20,2,0,Math.PI*2),e.arc(5,-20,2,0,Math.PI*2),e.fill()):(e.fillStyle="#ccc",e.beginPath(),e.moveTo(0,-30),e.lineTo(20,10),e.lineTo(10,20),e.lineTo(-10,20),e.lineTo(-20,10),e.closePath(),e.fill(),e.fillStyle="#00ccff",e.beginPath(),e.ellipse(0,-5,5,10,0,0,Math.PI*2),e.fill()),e.restore()}const J=H?.equipped?.galaxy_bullet||"bullet_laser";if(e.fillStyle="#ffcc00",t.bullets.forEach(n=>{J==="bullet_donut"?(e.font="20px serif",e.fillText("ðŸ©",n.x-5,n.y+10)):J==="bullet_cat"?(e.font="20px serif",e.fillText("ðŸ±",n.x-5,n.y+10)):e.fillRect(n.x,n.y,E,20)}),e.fillStyle="#ff0055",e.font="40px serif",t.enemies.forEach(n=>{e.fillText("ðŸ‘¾",n.x,n.y+40)}),e.fillStyle="#ff0000",t.enemyLasers.forEach(n=>{e.fillRect(n.x,n.y,n.width,n.height)}),t.powerups.forEach(n=>{e.fillStyle="gold",e.beginPath(),e.arc(n.x+15,n.y+15,15,0,Math.PI*2),e.fill(),e.fillStyle="black",e.font="20px Arial",e.fillText("P",n.x+8,n.y+22)}),t.boss){if(t.boss.flash>0&&(e.globalCompositeOperation="source-atop",e.fillStyle="white",t.boss.flash--),S.current&&S.current.complete){e.save(),e.translate(t.boss.x+a/2,t.boss.y+a/2);const _=Math.sin(Date.now()/200)*10;e.translate(0,_),e.rotate(Math.sin(Date.now()/500)*.1),e.drawImage(S.current,-a/2,-a/2,a,a),e.restore()}else e.font="80px Arial",e.fillText("ðŸ‘¹",t.boss.x+10,t.boss.y+80);const n=t.boss.hp/te;e.fillStyle="#333",e.fillRect(t.boss.x,t.boss.y-20,a,10),e.fillStyle=n>.5?"#00ff00":"red",e.fillRect(t.boss.x,t.boss.y-20,a*n,10)}e.restore(),t.animationId=requestAnimationFrame(K)},L=()=>{d.current&&c.current.lane>0&&c.current.lane--},P=()=>{d.current&&c.current.lane<k-1&&c.current.lane++},D=()=>{if(!d.current)return;const l=c.current,e=Date.now();if(e-l.lastShotTime>200){const t=l.lane*p+p/2-E/2;l.weaponTimer>0?(l.bullets.push({x:t-10,y:h-80,speed:15,dx:0}),l.bullets.push({x:t+10,y:h-80,speed:15,dx:0}),l.weaponTimer--):l.bullets.push({x:t,y:h-80,speed:15,dx:0}),l.lastShotTime=e,ie()}};f.useEffect(()=>{const l=e=>{d.current&&(["ArrowLeft","ArrowRight"," "].includes(e.key)&&e.preventDefault(),(e.key==="ArrowLeft"||e.key==="a"||e.key==="A")&&L(),(e.key==="ArrowRight"||e.key==="d"||e.key==="D")&&P(),e.key===" "&&D())};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[]);const y=f.useRef({startX:0,hasMoved:!1}),fe=l=>{if(!d.current)return;const e=l.touches[0];y.current={startX:e.clientX,hasMoved:!1}},he=l=>{if(!d.current)return;l.cancelable&&l.preventDefault();const e=l.touches[0],t=e.clientX-y.current.startX;Math.abs(t)>40&&(t>0?P():L(),y.current.startX=e.clientX,y.current.hasMoved=!0)},de=l=>{if(!d.current)return;const e=y.current.hasMoved;y.current={startX:0,hasMoved:!1},e||D()};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"10px",color:"#00ccff",minHeight:"100vh",touchAction:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",maxWidth:"480px",marginBottom:"5px",fontSize:"1rem",fontWeight:"bold"},children:[i.jsx("div",{style:{display:"flex",gap:"5px"},children:Array.from({length:C}).map((l,e)=>i.jsx("span",{style:{opacity:e<ne?1:.2},children:"â¤ï¸"},e))}),i.jsxs("span",{children:["SCORE: ",O]})]}),i.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:"480px"},children:[i.jsx("canvas",{ref:G,width:u,height:h,onTouchStart:fe,onTouchMove:he,onTouchEnd:de,style:{width:"100%",height:"auto",border:"4px solid #00ccff",background:"radial-gradient(circle, #001133 0%, #000000 100%)",borderRadius:"10px",boxShadow:"0 0 20px #00ccff40",touchAction:"none"}}),!oe&&!q&&!F&&i.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center"},children:[i.jsxs("p",{style:{color:"white",marginBottom:"10px"},children:["Use ",i.jsx("span",{style:{fontWeight:"bold"},children:"ARROWS"})," to move."]}),i.jsx(x,{onClick:j,style:{padding:"15px 40px",fontSize:"1.5rem",background:"#00ccff",border:"none",borderRadius:"10px"},children:"START MISSION"})]}),q&&i.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[i.jsx("h2",{style:{fontSize:"3rem",color:"#ff0055"},children:"GAME OVER"}),i.jsxs("p",{style:{fontSize:"1.5rem",marginBottom:"20px"},children:["Final Score: ",O]}),i.jsx(x,{onClick:j,style:{marginBottom:"10px",padding:"10px 30px",background:"#00ccff",border:"none",borderRadius:"5px"},children:"Retry"}),i.jsx(Q,{to:"/arcade",style:{color:"white",textDecoration:"underline"},children:"Exit"})]}),F&&i.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[i.jsx("h2",{style:{fontSize:"3rem",color:"#00ffaa"},children:"VICTORY!"}),i.jsx("p",{style:{fontSize:"1.5rem",marginBottom:"10px",color:"#fff"},children:"GALAXY SAVED"}),i.jsx(x,{onClick:j,style:{marginBottom:"10px",padding:"10px 30px",background:"gold",color:"black",border:"none",borderRadius:"5px"},children:"Play Again"}),i.jsx(Q,{to:"/arcade",style:{color:"white",textDecoration:"underline"},children:"Exit"})]})]}),i.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"20px",alignItems:"center",justifyContent:"center",width:"100%",paddingBottom:"20px"},children:[i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx(x,{onClick:L,style:{width:"60px",height:"60px",fontSize:"2rem",background:"#333",border:"2px solid #00ccff",borderRadius:"15px"},children:"â¬…ï¸"}),i.jsx(x,{onClick:P,style:{width:"60px",height:"60px",fontSize:"2rem",background:"#333",border:"2px solid #00ccff",borderRadius:"15px"},children:"âž¡ï¸"})]}),i.jsx(x,{onClick:D,style:{width:"80px",height:"80px",fontSize:"1.5rem",background:"red",border:"4px solid orange",borderRadius:"50%",boxShadow:"0 0 15px orange"},children:"ðŸ”¥"})]}),i.jsx("p",{style:{marginTop:"10px",color:"#666"},children:"Defeat the Head at 500 Points!"})]})};export{Se as default};
