import{r as a,b as Z,c as Q,j as o,S as _,L as R,t as ee}from"./index-DKzGAutY.js";import{feedService as te}from"./feed-Brgwye14.js";const d=400,l=600,ne=.6,oe=-10,ie=3,ae=200,i=40,E=[{id:"flappy_boy",type:"image",content:"/assets/merchboy_face.png",name:"MerchBoy"},{id:"flappy_face1",type:"image",content:"/assets/neon_brick/ball1.png",name:"Face 1"},{id:"flappy_face2",type:"image",content:"/assets/neon_brick/ball2.png",name:"Face 2"},{id:"flappy_face3",type:"image",content:"/assets/neon_brick/ball3.png",name:"Face 3"},{id:"flappy_face4",type:"image",content:"/assets/neon_brick/ball4.png",name:"Face 4"},{id:"flappy_brokid",type:"image",content:"/assets/brokid-logo.png",name:"BroKid"},{id:"flappy_cat",type:"emoji",content:"üê±",name:"Kitty"},{id:"flappy_dog",type:"emoji",content:"üê∂",name:"Puppy"},{id:"flappy_frog",type:"emoji",content:"üê∏",name:"Froggo"},{id:"flappy_unicorn",type:"emoji",content:"ü¶Ñ",name:"Uni"},{id:"flappy_rainbow",type:"emoji",content:"üåà",name:"Pride"},{id:"flappy_ghost",type:"emoji",content:"üëª",name:"Spooky"},{id:"flappy_zombie",type:"emoji",content:"üßü",name:"Walker"},{id:"flappy_vampire",type:"emoji",content:"üßõ",name:"Drac"},{id:"flappy_clown",type:"emoji",content:"ü§°",name:"Bozo"},{id:"flappy_poop",type:"emoji",content:"üí©",name:"Stinky"},{id:"flappy_hotdog",type:"emoji",content:"üå≠",name:"Glizzy"},{id:"flappy_taco",type:"emoji",content:"üåÆ",name:"Crunch"},{id:"flappy_burger",type:"emoji",content:"üçî",name:"Beefy"},{id:"flappy_alien",type:"emoji",content:"üëΩ",name:"Paul"},{id:"flappy_robot",type:"emoji",content:"ü§ñ",name:"Bot"},{id:"flappy_cowboy",type:"emoji",content:"ü§†",name:"Sheriff"},{id:"flappy_monster",type:"emoji",content:"üëæ",name:"8-Bit"},{id:"flappy_diamond",type:"emoji",content:"üíé",name:"Richie"},{id:"flappy_crown",type:"emoji",content:"üëë",name:"King"},{id:"flappy_catdog",type:"emoji",content:"üò∫",name:"CatDog"},{id:"flappy_face_money",type:"image",content:"/assets/skins/face_money.png",name:"Money"},{id:"flappy_face_bear",type:"image",content:"/assets/skins/face_bear.png",name:"Bear"},{id:"flappy_face_bunny",type:"image",content:"/assets/skins/face_bunny.png",name:"Bunny"}],ce=()=>{const T=a.useRef(null),{shopState:u,updateStat:h,incrementStat:se,equipItem:C,addCoins:H,userProfile:N,stats:S,coins:K,consumeItem:U}=Z()||{},[c,P]=a.useState(0),[A,B]=a.useState(parseInt(localStorage.getItem("flappyHighScore"))||0),[D,k]=a.useState(!1),[J,v]=a.useState(!1);a.useEffect(()=>{S?.flappyHighScore>A&&B(S.flappyHighScore)},[S]);const M=u?.equipped?.flappy||"flappy_boy",y=a.useRef(!1),{playJump:X,playCrash:V,playCollect:$}=Q(),F=a.useRef(null),z=a.useRef(null),G=a.useRef(null),Y=a.useRef(null),L=a.useRef(null),p=a.useRef({birdY:l/2,velocity:0,pipes:[],lastPipeTime:0,animationId:null});a.useEffect(()=>{const e=new Image;e.src="/assets/merchboy_face.png",F.current=e;const n=new Image;n.src="/assets/brokid-logo.png",z.current=n;const m=new Image;m.src="/assets/skins/face_money.png",G.current=m;const f=new Image;f.src="/assets/skins/face_bear.png",Y.current=f;const r=new Image;r.src="/assets/skins/face_bunny.png",L.current=r;for(let g=1;g<=4;g++){const b=new Image;b.src=`/assets/neon_brick/ball${g}.png`}const x=()=>{setCoins(parseInt(localStorage.getItem("arcadeCoins"))||0)};return window.addEventListener("storage",x),()=>window.removeEventListener("storage",x)},[]);const W=()=>{P(0),k(!1),v(!0),y.current=!0,p.current={birdY:l/2,velocity:0,pipes:[{x:d,topHeight:200}],lastPipeTime:0,animationId:null},requestAnimationFrame(j)},q=()=>{if(v(!1),y.current=!1,k(!0),cancelAnimationFrame(p.current.animationId),V(),c>A&&(B(c),h&&h("flappyHighScore",c),ee(),c>10)){const e=N?.name||"Player";te.publish(`is flying high! Score: ${c} in Flappy Mascot ü¶Ö`,"win",e)}H&&H(Math.floor(c)),h&&h("gamesPlayed","flappy_mascot")},j=()=>{if(!y.current)return;const e=T.current.getContext("2d"),n=p.current;if(e.fillStyle="#70c5ce",e.fillRect(0,0,d,l),n.velocity+=ne,n.birdY+=n.velocity,n.birdY>l-i||n.birdY<0){q();return}if(n.pipes.forEach(t=>{t.x-=ie}),n.pipes[n.pipes.length-1].x<d-ae){const s=l-150-50,I=Math.floor(Math.random()*(s-50+1)+50);n.pipes.push({x:d,topHeight:I})}n.pipes[0].x<-60&&(n.pipes.shift(),P(t=>t+1),$()),n.pipes.forEach(t=>{50+i>t.x&&50<t.x+60&&(n.birdY<t.topHeight||n.birdY+i>t.topHeight+150)&&q()}),e.fillStyle="#73bf2e",e.strokeStyle="#558c22",e.lineWidth=4,n.pipes.forEach(t=>{e.fillRect(t.x,0,60,t.topHeight),e.strokeRect(t.x,0,60,t.topHeight),e.fillRect(t.x-4,t.topHeight-20,68,20),e.strokeRect(t.x-4,t.topHeight-20,68,20);const s=t.topHeight+150;e.fillRect(t.x,s,60,l-s),e.strokeRect(t.x,s,60,l-s),e.fillRect(t.x-4,s,68,20),e.strokeRect(t.x-4,s,68,20)});const m=50,f=n.birdY,r=E.find(t=>t.id===M)||E[0];e.save(),e.translate(m+i/2,f+i/2);const x=Math.min(Math.PI/4,Math.max(-Math.PI/4,n.velocity*.1));e.rotate(x);const g=Math.sin(Date.now()/50)*.5,b=(t="front")=>{const s=n.velocity*.15+g,I=t==="back"?s*.8:s;e.save(),e.translate(-20,10),e.rotate(I),e.fillStyle="#fff",e.strokeStyle="#000",e.lineWidth=2.5,e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(-15,-15,-35,-5),e.quadraticCurveTo(-20,10,0,5),e.fill(),e.stroke(),e.beginPath(),e.strokeStyle="#ccc",e.lineWidth=1,e.moveTo(-10,-2),e.lineTo(-25,-2),e.stroke(),e.restore()};if(b("back"),e.strokeStyle="orange",e.lineWidth=3,e.beginPath(),e.moveTo(-5,15),e.lineTo(-10,25),e.moveTo(5,15),e.lineTo(10,25),e.stroke(),r.type==="image"){let t=null;if(r.id==="flappy_boy"?t=F.current:r.id==="flappy_brokid"?t=z.current:r.id==="flappy_face_money"?t=G.current:r.id==="flappy_face_bear"?t=Y.current:r.id==="flappy_face_bunny"&&(t=L.current),t&&t.complete)e.drawImage(t,-i/2,-i/2,i,i);else if(r.id.startsWith("flappy_face")){const s=new Image;s.src=r.content,e.drawImage(s,-i/2,-i/2,i,i)}else e.fillStyle="white",e.fillRect(-i/2,-i/2,i,i)}else e.font="35px serif",e.textAlign="center",e.textBaseline="middle",e.fillText(r.content,0,2);b("front"),e.restore(),e.fillStyle="#ded895",e.fillRect(0,l-20,d,20),e.beginPath(),e.moveTo(0,l-20),e.lineTo(d,l-20),e.strokeStyle="#73bf2e",e.stroke(),n.animationId=requestAnimationFrame(j)},O=a.useRef(0),w=()=>{if(!y.current)return;const e=Date.now();e-O.current<150||(O.current=e,p.current.velocity=oe,X())};return a.useEffect(()=>{const e=n=>{n.code==="Space"&&(n.preventDefault(),w())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",color:"#70c5ce"},children:[o.jsx("h1",{style:{fontFamily:'"Courier New", monospace',fontSize:"3rem",margin:"10px 0"},children:"FLAPPY MASCOT"}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"400px",marginBottom:"10px",fontSize:"1.2rem",color:"#fff",fontWeight:"bold"},children:[o.jsxs("span",{children:["SCORE: ",c]}),o.jsxs("span",{children:["COINS: ",K]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("canvas",{ref:T,width:d,height:l,onMouseDown:w,onTouchStart:e=>{e.cancelable&&e.preventDefault(),w()},style:{border:"4px solid #fff",borderRadius:"10px",boxShadow:"0 0 20px rgba(0,0,0,0.2)",cursor:"pointer",touchAction:"none"}}),!J&&!D&&o.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:o.jsx(_,{onClick:W,style:{padding:"15px 40px",fontSize:"1.5rem",background:"#ff9900",border:"none",borderRadius:"10px",color:"white"},children:"FLY!"})}),D&&o.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[o.jsx("h2",{style:{fontSize:"3rem",color:"#ff9900"},children:"GAME OVER"}),o.jsxs("p",{style:{fontSize:"1.5rem",marginBottom:"20px",color:"white"},children:["Score: ",c]}),u?.inventory?.flappy_shield>0&&o.jsxs(_,{onClick:()=>{U("flappy_shield")&&(k(!1),v(!0),y.current=!0,p.current.birdY=l/2,p.current.velocity=0,p.current.pipes.forEach(e=>e.x+=300),requestAnimationFrame(j))},style:{marginBottom:"15px",padding:"10px 30px",background:"var(--neon-blue)",border:"none",borderRadius:"5px",color:"black",fontWeight:"bold"},children:["üõ°Ô∏è USE SHIELD (",u.inventory.flappy_shield,")"]}),o.jsx(_,{onClick:W,style:{marginBottom:"10px",padding:"10px 30px",background:"#ff9900",border:"none",borderRadius:"5px",color:"white"},children:"Try Again"}),o.jsx(R,{to:"/arcade",style:{color:"white",textDecoration:"underline"},children:"Back to Base"})]})]}),o.jsxs("div",{style:{marginTop:"20px",width:"100%",maxWidth:"400px",overflowX:"auto",paddingBottom:"10px"},children:[o.jsx("p",{style:{color:"#fff",textAlign:"center",marginBottom:"5px"},children:"SELECT PILOT"}),o.jsx("div",{style:{display:"flex",gap:"10px",padding:"0 10px"},children:E.map(e=>{const m=["flappy_boy","flappy_face1","flappy_face2","flappy_face3","flappy_face4"].includes(e.id)||u?.unlocked?.includes(e.id),f=M===e.id;return m?o.jsxs("button",{onClick:()=>{C&&(C("flappy",e.id),navigator.vibrate&&navigator.vibrate(20))},style:{background:f?"#ff9900":"rgba(255,255,255,0.2)",border:f?"2px solid white":"1px solid rgba(255,255,255,0.1)",borderRadius:"10px",padding:"10px",minWidth:"60px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"5px"},children:e.type==="emoji"?e.content:e.id==="flappy_boy"?"üë¶":"üÖ±Ô∏è"}),o.jsx("span",{style:{fontSize:"0.7rem",color:"white",whiteSpace:"nowrap"},children:e.name})]},e.id):null})})]}),o.jsx("div",{style:{textAlign:"center",marginTop:"10px"},children:o.jsx(R,{to:"/shop",style:{color:"gold",textDecoration:"none",fontSize:"0.9rem"},children:"üõçÔ∏è Get More Pilots"})}),o.jsx("p",{style:{marginTop:"10px",color:"#666"},children:"Space or Click to Flap"}),o.jsx(R,{to:"/arcade",style:{position:"absolute",top:"10px",left:"10px",zIndex:100},children:o.jsx(_,{style:{borderRadius:"50px",padding:"10px 20px",fontSize:"1.2rem",background:"rgba(255,255,255,0.2)"},children:"üè† EXIT"})})]})};export{ce as default};
