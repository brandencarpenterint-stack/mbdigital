import{b as Q,r,x as Z,c as ee,j as s,S as V,L as te}from"./index-DKzGAutY.js";import{feedService as ne}from"./feed-Brgwye14.js";const w=[{name:"NEON CITY",bg:"#0d0221",grid:"#ff00ff",obs:["#00ffaa","#ff00ff"]},{name:"MAGMA CORE",bg:"#220000",grid:"#ff4400",obs:["#ffaa00","#ff4400"]},{name:"ICE CAVERN",bg:"#001133",grid:"#00ffff",obs:["#ffffff","#88ccff"]},{name:"TOXIC JUNGLE",bg:"#002200",grid:"#00ff00",obs:["#ccff00","#009900"]},{name:"THE VOID",bg:"#ffffff",grid:"#000000",obs:["#000000","#333333"]}],ie=()=>{const{updateStat:M,addCoins:v,userProfile:L,stats:I}=Q()||{},b=r.useRef(null),{soundEnabled:re}=Z(),{playCrash:X}=ee(),g=800,m=600,Y=2e3,[k,N]=r.useState("START"),[S,z]=r.useState(!1),[H,_]=r.useState(0),[T,q]=r.useState(parseInt(localStorage.getItem("faceRunnerHighScore"))||0);r.useEffect(()=>{I?.faceRunnerHighScore>T&&q(I.faceRunnerHighScore)},[I]);const[$,oe]=r.useState("face_money"),y=r.useRef(!1),A=r.useRef(30),d=r.useRef(0),G=r.useRef(0),x=r.useRef({x:0,y:0,squash:1}),h=r.useRef([]),C=r.useRef(null),P=r.useRef({});r.useEffect(()=>(["face_money","face_bear","face_bunny","face_default"].forEach(c=>{const o=new Image;o.src=`/assets/skins/${c}.png`,P.current[c]=o}),()=>cancelAnimationFrame(C.current)),[]);const F=()=>{N("PLAYING"),z(!1),y.current=!0,_(0),A.current=30,d.current=0,G.current=0,x.current={x:0,y:0,squash:1},h.current=[],C.current=requestAnimationFrame(O)},U=e=>{const o=e.obs[Math.floor(Math.random()*e.obs.length)];h.current.push({x:(Math.random()-.5)*800*1.5,y:(Math.random()-.5)*800*1.5,z:Y,color:o,rot:Math.random()*Math.PI,size:100+Math.random()*100})},O=()=>{if(!b.current)return;const e=b.current.getContext("2d"),c=g,o=m,a=c/2,f=o/2,R=Math.floor(d.current),p=Math.floor(R/2500)%w.length;G.current=p;const E=w[p];if(y.current){A.current=Math.min(30+d.current*.015,120),Math.random()<.08&&U(E);for(let t=h.current.length-1;t>=0;t--){const n=h.current[t];n.z-=A.current,n.z<=0&&(h.current.splice(t,1),d.current+=5,_(Math.floor(d.current)))}}e.fillStyle=E.bg,e.fillRect(0,0,c,o),e.strokeStyle=E.grid,e.lineWidth=2,e.beginPath();for(let t=0;t<8;t++){const n=t/8*Math.PI*2;e.moveTo(a,f),e.lineTo(a+Math.cos(n)*c,f+Math.sin(n)*o)}const K=performance.now()*A.current*.05%500;for(let t=500;t>0;t-=500/5){const n=(t-K+500)%500;if(n<10)continue;const u=50*(500/n);u<c*2&&e.rect(a-u,f-u,u*2,u*2)}if(e.stroke(),h.current.sort((t,n)=>n.z-t.z),h.current.forEach(t=>{if(t.z<10)return;const i=600/t.z,u=a+t.x*i,B=f+t.y*i,l=t.size*i;if(e.save(),e.translate(u,B),e.rotate(t.rot+performance.now()*.002),t.z<100&&y.current){const W=u-(a+x.current.x),D=B-(f+x.current.y);Math.sqrt(W*W+D*D)<l/2+30&&J()}e.fillStyle=t.color,e.shadowBlur=10,e.shadowColor=t.color,e.fillRect(-l/2,-l/2,l,l),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(-l/4,-l/4,l/2,l/2),e.restore()}),y.current){const t=x.current;t.squash=1+Math.sin(performance.now()*.02)*.05,e.save(),e.translate(a+t.x,f+t.y),e.scale(t.squash,1/t.squash);const n=P.current[$],i=100;n&&n.complete&&n.naturalWidth>0?(e.shadowBlur=20,e.shadowColor="white",e.drawImage(n,-i/2,-i/2,i,i)):(e.fillStyle="white",e.beginPath(),e.arc(0,0,i/2,0,Math.PI*2),e.fill()),e.restore()}e.fillStyle="white",e.font='20px "Orbitron", sans-serif',e.textAlign="center",e.fillText(E.name,a,40),e.font="14px monospace",e.fillText(`DISTANCE: ${Math.floor(d.current)}m`,a,65),C.current=requestAnimationFrame(O)},J=()=>{const e=Math.floor(d.current);if(M&&M("gamesPlayed","face_runner"),v&&v(Math.floor(e/10)),e>T){q(e),M&&M("faceRunnerHighScore",e);const c=L?.name||"Runner";ne.publish(`reached ${e}m in Face Runner!`,"win",c)}N("GAME_OVER"),y.current=!1,X(),z(!1),setTimeout(()=>z(!0),1500)},j=(e,c)=>{if(!b.current)return;const o=b.current.getBoundingClientRect(),a=g/o.width,f=m/o.height;let R=(e-o.left)*a-g/2,p=(c-o.top)*f-m/2;R=Math.max(-g/2+50,Math.min(g/2-50,R)),p=Math.max(-m/2+50,Math.min(m/2-50,p)),x.current.x=R,x.current.y=p};return s.jsxs("div",{className:"page-enter",style:{position:"fixed",inset:0,background:"black",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"},children:[s.jsx("canvas",{ref:b,width:g,height:m,onMouseMove:e=>j(e.clientX,e.clientY),onTouchMove:e=>{e.preventDefault(),j(e.touches[0].clientX,e.touches[0].clientY)},onTouchStart:e=>{j(e.touches[0].clientX,e.touches[0].clientY)},style:{width:"100%",height:"100%",objectFit:"contain",maxWidth:"800px",maxHeight:"600px",border:`4px solid ${w[Math.floor(Math.floor(H)/2500)%w.length]?.obs[0]||"white"}`}}),k==="START"&&s.jsxs("div",{style:{position:"absolute",textAlign:"center",background:"rgba(0,0,0,0.8)",padding:"40px",borderRadius:"20px",border:"2px solid cyan"},children:[s.jsx("h1",{style:{color:"cyan",fontSize:"3rem",margin:0},children:"FACE WARP"}),s.jsx("p",{style:{color:"white",marginBottom:"20px"},children:"Avoid the Void."}),s.jsx(V,{onClick:F,style:{background:"cyan",color:"black",fontSize:"1.5rem",padding:"15px 40px"},children:"RUN"})]}),k==="GAME_OVER"&&s.jsxs("div",{style:{position:"absolute",textAlign:"center",background:"rgba(0,0,0,0.8)",padding:"40px",borderRadius:"20px",border:"2px solid red"},children:[s.jsx("h1",{style:{color:"red",fontSize:"3rem",margin:0},children:"CRASHED!"}),s.jsxs("p",{style:{color:"white",fontSize:"2rem",fontWeight:"bold"},children:[Math.floor(H),"m"]}),s.jsxs("p",{style:{color:"#aaa",marginBottom:"20px"},children:["BEST: ",T,"m"]}),s.jsx(V,{onClick:()=>S&&F(),style:{background:S?"white":"#555",color:S?"black":"#888",fontSize:"1.5rem",padding:"15px 40px",cursor:S?"pointer":"wait"},children:S?"AGAIN":"WAIT..."})]}),s.jsx(te,{to:"/arcade",style:{position:"absolute",top:"20px",left:"20px",zIndex:9999,textDecoration:"none"},children:s.jsx("div",{style:{background:"#ff0055",color:"white",padding:"10px 20px",borderRadius:"30px",fontWeight:"bold",boxShadow:"0 5px 15px rgba(255, 0, 85, 0.4)",boxSizing:"border-box",fontSize:"1rem",display:"flex",alignItems:"center",gap:"5px"},children:"üè† EXIT"})})]})};export{ie as default};
